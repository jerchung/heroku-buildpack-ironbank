#!/bin/bash

BUILD_DIR="$1"
CACHE_DIR="$2"
ENV_DIR="$3"

MAVEN_URL="http://www.gtlib.gatech.edu/pub/apache/maven/maven-3/3.3.9/binaries/apache-maven-3.3.9-bin.tar.gz"
MAVEN_DIR="apache-maven-3.3.9"

# Set up Maven
if [ ! -d "$CACHE_DIR/$MAVEN_DIR" ]; then
    wget -qO- "$MAVEN_URL" | tar xz
    cp -r "$MAVEN_DIR" "$CACHE_DIR"
else
    cp -r "$CACHE_DIR/$MAVEN_DIR" .
fi

ls .

echo "PATH before: $PATH"
export PATH="$PATH:$(pwd)/$MAVEN_DIR/bin"
echo "PATH after: $PATH"

# Build entire project
cd "$BUILD_DIR"
mvn install

# Build WAR file
mvn play:initialize play:precompile --projects ironbank-credit
